on: [push, pull_request]

name: windows path silliness

jobs:
  native:
    strategy:
      fail-fast: false
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - uses: r-lib/actions/setup-r@v2
        with:
          r-version: "latest"
          use-public-rspm: true
      - name: Install renv package
        run: |
          Rscript -e 'install.packages("renv")'
      - name: Print system path
        run: |
          echo "Current PATH:"
          echo $env:PATH
      - name: Update PATH with R directory
        run: |
          $rDir = Get-ChildItem "C:\Program Files\R" -Directory -Filter "R-*" | Select-Object -First 1 -ExpandProperty FullName
          if ($rDir) {
            $binPath = Join-Path $rDir "bin"
            echo "Found R bin directory at: $binPath"
            $newPath = $env:PATH -replace "C:\\R\\bin", "$binPath"
            echo "PATH=$newPath" | Out-File -FilePath $env:GITHUB_ENV -Encoding utf8 -Append
            echo "Updated PATH to use $binPath instead of C:\R\bin"
          } else {
            echo "No R directory found matching R-* pattern"
          }
      - name: Verify updated PATH
        run: |
          echo "Updated PATH:"
          echo $env:PATH
